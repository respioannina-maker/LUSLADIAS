<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LUS PROTOCOL â€” LUS Daily</title>
  <style>
    :root{
      --blue:#0A84FF; --blue-dark:#086fe0; --bg:#0b1220; --card:#101a2e;
      --text:#e9eefb; --muted:#a9b6d9; --ok:#10b981; --err:#ef4444; --border:#1f2a44; --input:#0f1830;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; background:linear-gradient(180deg,#0b1220 0%,#0b1220 40%,#0e1530 100%);
      color:var(--text); font:15px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
      display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .container{width:100%; max-width:1050px; display:grid; gap:16px; grid-template-columns:1.1fr 1fr}
    .brand{
      grid-column:1/-1; display:flex; align-items:center; justify-content:space-between;
      padding:16px 20px; border:1px solid var(--border); border-radius:14px;
      background:linear-gradient(180deg,#0f1830,#0b1328);
      box-shadow:0 10px 30px rgba(10,132,255,0.08), inset 0 1px 0 rgba(255,255,255,0.04);
    }
    .brand h1{margin:0; font-size:18px; letter-spacing:.4px}
    .badge{padding:6px 10px; border-radius:999px; background:rgba(10,132,255,.15); color:#cfe2ff; border:1px solid rgba(10,132,255,.35); font-size:12px}

    .card{background:var(--card); border:1px solid var(--border); border-radius:16px; padding:18px;
      box-shadow:0 10px 30px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.04)}
    .card h2{margin:0 0 12px 0; font-size:16px; color:#dce6ff}
    .grid{display:grid; gap:12px}
    .cols-2{grid-template-columns:1fr 1fr}
    .cols-3{grid-template-columns:repeat(3,1fr)}
    label{font-size:12px; color:var(--muted); display:block; margin-bottom:6px}
    input,select{
      width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--border);
      background:var(--input); color:var(--text); outline:none; transition:.12s border-color
    }
    input:focus,select:focus{border-color:var(--blue)}
    .row{display:flex; gap:12px; flex-wrap:wrap}
    .btn{
      appearance:none; border:none; border-radius:12px; padding:12px 16px; font-weight:700; cursor:pointer;
      background:linear-gradient(180deg,var(--blue),var(--blue-dark)); color:white;
      box-shadow:0 10px 24px rgba(10,132,255,.25), inset 0 1px 0 rgba(255,255,255,.25);
      transition:transform .06s ease;
    }
    .btn:active{transform:translateY(1px)}
    .btn.secondary{background:transparent; color:var(--text); border:1px solid var(--border); box-shadow:none}
    .pill{display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px;
      background:rgba(10,132,255,.12); color:#cfe2ff; border:1px solid rgba(10,132,255,.28); font-size:12px}
    .muted{color:var(--muted); font-size:12px}
    .toast{
      position:fixed; right:16px; bottom:16px; background:#0f1a34; border:1px solid var(--border); color:var(--text);
      padding:12px 14px; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.35); display:none; max-width:70%
    }
    .toast.ok{border-color:rgba(16,185,129,.45); background:rgba(16,185,129,.08)}
    .toast.err{border-color:rgba(239,68,68,.45); background:rgba(239,68,68,.08)}
    .hint{font-size:12px; color:#a9b6d9}
    @media (max-width:980px){.container{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">

    <div class="brand">
      <h1>ğŸ©º LUS PROTOCOL â€” LUS Daily</h1>
      <span class="badge">Î Î“ÎÎ™ â€¢ Î Î½ÎµÏ…Î¼Î¿Î½Î¿Î»Î¿Î³Î¹ÎºÎ® ÎšÎ»Î¹Î½Î¹ÎºÎ®</span>
    </div>

    <!-- Î‘ÏÎ¹ÏƒÏ„ÎµÏÎ¬: Î¤Î±Ï…Ï„ÏŒÏ„Î·Ï„Î± & LUS -->
    <div class="card">
      <h2>Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î®Ï‚</h2>
      <div class="grid cols-2">
        <div>
          <label for="operator">Î§ÎµÎ¹ÏÎ¹ÏƒÏ„Î®Ï‚ (Operator)</label>
          <select id="operator" required>
            <option value="" disabled selected>â€” ÎµÏ€Î¯Î»ÎµÎ¾Îµ â€”</option>
            <option>Ladias</option>
            <option>Xronis</option>
            <option>Other</option>
          </select>
        </div>
        <div>
          <label for="nps">NPS (Patient ID)</label>
          <input id="nps" type="text" placeholder="Ï€.Ï‡. 123456" required />
        </div>
        <div>
          <label for="firstName">ÎŒÎ½Î¿Î¼Î± (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ)</label>
          <input id="firstName" type="text" />
        </div>
        <div>
          <label for="lastName">Î•Ï€ÏÎ½Ï…Î¼Î¿ (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ)</label>
          <input id="lastName" type="text" />
        </div>
        <div>
          <label for="admDate">Î—Î¼. ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î®Ï‚ (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ)</label>
          <input id="admDate" type="date" />
        </div>
        <div>
          <label for="day">Î—Î¼Î­ÏÎ±</label>
          <select id="day" required>
            <option value="" disabled selected>â€” D1â€“D7/Exit â€”</option>
            <option>D1</option><option>D2</option><option>D3</option><option>D4</option>
            <option>D5</option><option>D6</option><option>D7</option><option>Exit</option>
          </select>
        </div>

        <div>
          <label for="lus">LUS score (0â€“36)</label>
          <input id="lus" type="number" min="0" max="36" step="1" required />
        </div>
        <div style="display:flex;align-items:end;gap:10px">
          <input id="hourly" type="checkbox" />
          <label for="hourly">Î©ÏÎ¹Î±Î¯Î± ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î®</label>
        </div>

        <div>
          <label for="position">Î˜Î­ÏƒÎ· Î±ÏƒÎ¸ÎµÎ½Î¿ÏÏ‚ ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎ¾Î­Ï„Î±ÏƒÎ·</label>
          <select id="position">
            <option value="" disabled selected>â€” ÎµÏ€Î¯Î»ÎµÎ¾Îµ â€”</option>
            <option>ÎšÎ±Î¸Î¹ÏƒÏ„ÏŒÏ‚</option>
            <option>Î—Î¼Î¹ÎºÎ±Î¸Î¹ÏƒÏ„ÏŒÏ‚</option>
            <option>ÎÏ€Ï„Î¹Î±</option>
            <option>Î Î»Î¬Î³Î¹Î±</option>
          </select>
        </div>
      </div>

      <h2 style="margin-top:16px">Î Î»ÎµÏ…ÏÎ¯Ï„Î¹Î´Î± / Consolidation / Pneumo</h2>
      <div class="grid cols-3">
        <div>
          <label for="pleural">Î Î»ÎµÏ…ÏÎ¹Ï„Î¹ÎºÏŒ Ï…Î³ÏÏŒ</label>
          <select id="pleural">
            <option value="" disabled selected>â€”</option>
            <option>ÎŒÏ‡Î¹</option>
            <option>ÎÎ±Î¹</option>
          </select>
        </div>
        <div id="pleuralSideWrap" style="display:none">
          <label for="side">Î Î»ÎµÏ…ÏÎ¬</label>
          <select id="side">
            <option value="" disabled selected>â€”</option>
            <option>Î”ÎµÎ¾Î¹Î¬</option>
            <option>Î‘ÏÎ¹ÏƒÏ„ÎµÏÎ¬</option>
            <option>Î‘Î¼Ï†Î¿Ï„ÎµÏÏŒÏ€Î»ÎµÏ…ÏÎ±</option>
          </select>
        </div>
        <div id="ipdWrap" style="display:none">
          <label for="ipd">Interpleural distance (mm)</label>
          <input id="ipd" type="number" min="0" step="1" />
          <div class="hint">ÎŒÎ³ÎºÎ¿Ï‚ Balik (mL): <span id="balik">â€”</span></div>
        </div>
        <div>
          <label for="cons">Consolidation (cm)</label>
          <input id="cons" type="number" min="0" step="0.1" />
        </div>
        <div>
          <label for="pneumo">Î Î½ÎµÏ…Î¼Î¿Î¸ÏÏÎ±ÎºÎ±Ï‚</label>
          <select id="pneumo">
            <option value="" disabled selected>â€”</option>
            <option>ÎŒÏ‡Î¹</option>
            <option>ÎÎ±Î¹</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-top:14px">
        <button class="btn" id="submitBtn">ÎšÎ±Ï„Î±Ï‡ÏÏÎ¹ÏƒÎ·</button>
        <button class="btn secondary" id="clearBtn">ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚</button>
      </div>
    </div>

    <!-- Î”ÎµÎ¾Î¹Î¬: ÎŸÎ¾Ï…Î³ÏŒÎ½Ï‰ÏƒÎ· & Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· -->
    <div class="card">
      <h2>ÎŸÎ¾Ï…Î³ÏŒÎ½Ï‰ÏƒÎ· & Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î·</h2>
      <div class="grid cols-2">
        <div>
          <label for="spo2">SpOâ‚‚ (%)</label>
          <input id="spo2" type="number" min="50" max="100" step="1" />
        </div>
        <div>
          <label for="fio2">FiOâ‚‚ (0.21â€“1.0)</label>
          <input id="fio2" type="number" min="0.21" max="1" step="0.01" />
          <div class="hint">S/F ratio: <span id="sf">â€”</span></div>
        </div>

        <div>
          <label for="device">Î£Ï…ÏƒÎºÎµÏ…Î® ÎŸâ‚‚</label>
          <select id="device">
            <option value="" disabled selected>â€”</option>
            <option>NC</option>
            <option>Mask</option>
            <option>Venturi</option>
            <option>HFNO</option>
            <option>NIV</option>
          </select>
        </div>
        <div id="flowWrap" style="display:none">
          <label for="flow">Î¡Î¿Î® (L/min)</label>
          <input id="flow" type="number" min="0" step="1" />
        </div>

        <div id="nivWrap" style="display:none">
          <label for="ipap">NIV IPAP (cmHâ‚‚O)</label>
          <input id="ipap" type="number" min="0" step="1" />
        </div>
        <div id="nivWrap2" style="display:none">
          <label for="epap">NIV EPAP (cmHâ‚‚O)</label>
          <input id="epap" type="number" min="0" step="1" />
        </div>
      </div>

      <div style="margin-top:10px" class="muted">
        * Î¤Î± Ï€Î±ÏÎ±Ï€Î¬Î½Ï‰ Ï€ÎµÎ´Î¯Î± ÎµÎ¯Î½Î±Î¹ Î³ÏÎ®Î³Î¿ÏÎ· ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î® ÎºÎ±Î¸Î·Î¼ÎµÏÎ¹Î½Î®Ï‚ Ï€Î¿ÏÎµÎ¯Î±Ï‚. Î— Ï€Î»Î®ÏÎ·Ï‚ Î±ÏÏ‡Î¹ÎºÎ® ÎºÎ±Ï„Î±Ï‡ÏÏÎ¹ÏƒÎ· Î³Î¯Î½ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ CRF Master.
      </div>
    </div>

    <div class="brand" style="justify-content:center">
      <span class="pill">ÎœÎµÏ„Î¬ Ï„Î·Î½ ÎºÎ±Ï„Î±Ï‡ÏÏÎ¹ÏƒÎ·, ÎµÎ½Î·Î¼ÎµÏÏÎ½Î¿Î½Ï„Î±Î¹: LUS_DailyMatrix, OPR_Operator, LUS_ByUser, LUS_ByNPS.</span>
    </div>

  </div>

  <div id="toast" class="toast"></div>

  <script>
    // ğŸ‘‰ Î’Î‘Î›Î• Î•Î”Î© Ï„Î¿ Apps Script Web App URL (Ï„ÎµÎ»ÎµÎ¹ÏÎ½ÎµÎ¹ ÏƒÎµ /exec)
    const WEB_APP_URL = "https://script.google.com/macros/s/PASTE_YOUR_ID/exec";

    const $ = (id) => document.getElementById(id);
    const el = {
      operator:$("operator"), nps:$("nps"), firstName:$("firstName"), lastName:$("lastName"),
      admDate:$("admDate"), day:$("day"), lus:$("lus"), hourly:$("hourly"),
      position:$("position"),
      pleural:$("pleural"), side:$("side"), ipd:$("ipd"), balik:$("balik"),
      cons:$("cons"), pneumo:$("pneumo"),
      spo2:$("spo2"), fio2:$("fio2"), sf:$("sf"),
      device:$("device"), flow:$("flow"), ipap:$("ipap"), epap:$("epap"),
      submitBtn:$("submitBtn"), clearBtn:$("clearBtn"),
      pleuralSideWrap:document.getElementById("pleuralSideWrap"),
      ipdWrap:document.getElementById("ipdWrap"),
      flowWrap:document.getElementById("flowWrap"),
      nivWrap:document.getElementById("nivWrap"),
      nivWrap2:document.getElementById("nivWrap2"),
      toast:$("toast")
    };

    const DAY_VALID=["D1","D2","D3","D4","D5","D6","D7","Exit"];

    function showToast(msg,type="ok",ms=3000){
      el.toast.textContent = msg;
      el.toast.className = "toast " + (type==="ok" ? "ok" : "err");
      el.toast.style.display = "block";
      setTimeout(()=> el.toast.style.display="none", ms);
    }

    function disableUI(disabled){
      el.submitBtn.disabled = disabled;
      el.clearBtn.disabled  = disabled;
      el.submitBtn.style.opacity = disabled ? 0.7 : 1;
    }

    function calcSF(){
      const spo2 = Number(el.spo2.value);
      const fio2 = Number(el.fio2.value);
      if(Number.isFinite(spo2) && Number.isFinite(fio2) && fio2>=0.21 && fio2<=1 && spo2>0){
        el.sf.textContent = Math.round(spo2 / fio2);
      } else { el.sf.textContent = "â€”"; }
    }

    function calcBalik(){
      const dmm = Number(el.ipd.value);
      if(Number.isFinite(dmm) && dmm>=0){
        el.balik.textContent = Math.round(20 * dmm); // Balik: 20 Ã— D(mm)
      } else { el.balik.textContent = "â€”"; }
    }

    function onPleuralChange(){
      const v = el.pleural.value;
      const show = (v==="ÎÎ±Î¹");
      el.pleuralSideWrap.style.display = show ? "" : "none";
      el.ipdWrap.style.display = show ? "" : "none";
    }

    function onDeviceChange(){
      const v = el.device.value;
      el.flowWrap.style.display = (v==="HFNO" || v==="NC" || v==="Mask" || v==="Venturi") ? "" : "none";
      const isNIV = (v==="NIV");
      el.nivWrap.style.display  = isNIV ? "" : "none";
      el.nivWrap2.style.display = isNIV ? "" : "none";
    }

    function getPayload(){
      // LUS core (Î±Ï…Ï„Î¬ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ ÏƒÎ¯Î³Î¿Ï…ÏÎ± Î¿ server)
      const core = {
        operator: (el.operator.value||"").trim(),
        nps:      (el.nps.value||"").trim(),
        firstName:(el.firstName.value||"").trim(),
        lastName: (el.lastName.value||"").trim(),
        admDate:  el.admDate.value || "",
        day:      el.day.value,
        lus:      el.lus.value !== "" ? String(parseInt(el.lus.value,10)) : ""
      };

      // Î•Ï€ÎµÎºÏ„Î¬ÏƒÎµÎ¹Ï‚ (Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Ï…Ï€Î¿Ï‡ÏÎµÏ‰Ï„Î¹ÎºÏŒ Î½Î± Ï„Î± Î´Î¹Î±Î²Î¬ÏƒÎµÎ¹ Î¿ server â€” Î±Ï€Î»ÏÏ‚ Ï„Î± ÏƒÏ„Î­Î»Î½Î¿Ï…Î¼Îµ)
      const extras = {
        hourly:   el.hourly.checked ? "ÎÎ±Î¹" : "ÎŒÏ‡Î¹",
        position: el.position.value,

        pleural:  el.pleural.value,
        side:     el.side.value,
        ipd:      el.ipd.value,
        balik:    (el.balik.textContent && el.balik.textContent!=="â€”") ? el.balik.textContent : "",

        cons:     el.cons.value,
        pneumo:   el.pneumo.value,

        spo2:     el.spo2.value,
        fio2:     el.fio2.value,
        sf:       (el.sf.textContent && el.sf.textContent!=="â€”") ? el.sf.textContent : "",

        device:   el.device.value,
        flow:     el.flow.value,
        ipap:     el.ipap.value,
        epap:     el.epap.value
      };

      // Î£Ï„Î­Î»Î½Î¿Ï…Î¼Îµ Ï‰Ï‚ x-www-form-urlencoded (Î³Î¹Î± Î½Î± Î±Ï€Î¿Ï†ÏÎ³Î¿Ï…Î¼Îµ CORS preflight)
      const params = new URLSearchParams({...core, ...extras});
      return params.toString();
    }

    function validate(){
      if(!el.operator.value) return "Î”ÏÏƒÎµ Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î® (Operator).";
      if(!el.nps.value) return "Î”ÏÏƒÎµ NPS (Patient ID).";
      if(!DAY_VALID.includes(el.day.value)) return "Î•Ï€Î¯Î»ÎµÎ¾Îµ Î—Î¼Î­ÏÎ± (D1â€“D7/Exit).";
      const n = Number(el.lus.value);
      if(!Number.isFinite(n) || n<0 || n>36) return "LUS score: Î±ÎºÎ­ÏÎ±Î¹Î¿Ï‚ 0â€“36.";
      return null;
    }

    async function submit(){
      const err = validate();
      if(err){ showToast(err,"err",3800); return; }
      disableUI(true);

      try{
        const res = await fetch(WEB_APP_URL, {
          method:"POST",
          headers:{ "Content-Type":"application/x-www-form-urlencoded;charset=UTF-8" },
          body:getPayload()
        });

        // Î±Î¹ÏƒÎ¹ÏŒÎ´Î¿Î¾Î¿ success + Ï€ÏÎ¿ÏƒÏ€Î¬Î¸ÎµÎ¹Î± Î±Î½Î¬Î³Î½Ï‰ÏƒÎ·Ï‚ JSON
        let okShown = false;
        try{
          const txt = await res.text();
          if (txt && txt.startsWith("{")) {
            const j = JSON.parse(txt);
            if (j.ok) { showToast("âœ… ÎšÎ±Ï„Î±Ï‡Ï‰ÏÎ®Î¸Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!"); okShown = true; }
            else { showToast("âŒ " + (j.error||"Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î±Ï‡ÏÏÎ¹ÏƒÎ·Ï‚"),"err",4200); }
          }
        }catch(_){}
        if(!okShown) showToast("âœ… ÎšÎ±Ï„Î±Ï‡Ï‰ÏÎ®Î¸Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!");

        clearForm();
      }catch(e){
        console.error(e);
        showToast("âŒ Î”Î¹ÎºÏ„Ï…Î±ÎºÏŒ ÏƒÏ†Î¬Î»Î¼Î± Î® Î»Î¬Î¸Î¿Ï‚ URL.","err",4200);
      }finally{
        disableUI(false);
      }
    }

    function clearForm(){
      ["nps","firstName","lastName","admDate","lus","ipd","cons","spo2","fio2","flow","ipap","epap"].forEach(id=>{
        const node = document.getElementById(id); if (node) node.value="";
      });
      ["day","position","pleural","side","pneumo","device"].forEach(id=>{
        const node = document.getElementById(id); if (node) node.value="";
      });
      el.hourly.checked = false;
      el.sf.textContent = "â€”";
      el.balik.textContent = "â€”";
      el.pleuralSideWrap.style.display = "none";
      el.ipdWrap.style.display = "none";
      el.flowWrap.style.display = "none";
      el.nivWrap.style.display = "none";
      el.nivWrap2.style.display = "none";
      el.nps.focus();
    }

    // Listeners
    el.fio2.addEventListener("input", calcSF);
    el.spo2.addEventListener("input", calcSF);
    el.ipd.addEventListener("input", calcBalik);
    el.pleural.addEventListener("change", onPleuralChange);
    el.device.addEventListener("change", onDeviceChange);
    el.submitBtn.addEventListener("click", submit);
    el.clearBtn.addEventListener("click", clearForm);

    // Enter â†’ submit ÏƒÎµ NPS & LUS
    ["nps","lus"].forEach(id=>{
      const node = document.getElementById(id);
      if(node) node.addEventListener("keydown",(e)=>{ if(e.key==="Enter") submit(); });
    });
  </script>
</body>
</html>
